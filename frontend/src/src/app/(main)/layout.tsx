"use client";

import React, { useEffect } from "react";
import { useAtom } from "jotai";

import EventSidebar from "@/components/Home/EventSidebar";
import ProfileCard from "@/components/Profile/ProfileCard";
import BettingSidebar from "@/components/Home/BettingSidebar";

// import type { Metadata } from "next";
import { Splitter } from "antd";
import Layout from "@/components/Layout";
import "@/styles/globals.css";
import DeviceTracker from "@/components/Common/DeviceTracker";
import ContactCard from "@/components/Common/Contact";
import { showBettingCartState, userState } from "@/state/state";
import api from "@/api";
import CasinoSidebar from "@/components/Casino/CasinoSidebar";
import { useRouter , usePathname} from "next/navigation";
/* 
export const metadata: Metadata = {
  title: "Betting",
  description: "Generated by Betting",
}; */

export default function RootLayout({
  children,
}: Readonly<{
  children: React.ReactNode;
}>) {
  const pathname = usePathname();
  const [showBettingCart] = useAtom(showBettingCartState);
  const [profile, setProfile] = useAtom<any>(userState);
  useEffect(() => {
    api("user/me").then((res) => {
      setProfile(res.data.profile);
    }).catch((err) => {
      console.log(err);
    });
  }, []);
  return (
    <Layout>
      <DeviceTracker />
      <Splitter className="shadow">
        <Splitter.Panel
          defaultSize="20%"
          max="40%"
          style={{
            scrollbarWidth: "inherit",
          }}
          className="!pr-2 h-[calc(100vh-40px)] hidden md:block"
          collapsible
        >
          {
            pathname === "/casino"  ?  (<CasinoSidebar />) : (<EventSidebar />)
          }
        </Splitter.Panel>
        <Splitter.Panel
          defaultSize="80%"
          style={{
            scrollbarWidth: "inherit",
          }}
          className="!basis-full"
        >
          <div className="flex">
            <div className="w-full md:w-3/4">{children}</div>
            <div
              style={{
                scrollbarWidth: "inherit",
              }}
              className="w-1/4 h-[calc(100vh-40px)] hidden md:block"
            >
              <ProfileCard />
              {showBettingCart && <BettingSidebar />}
              <ContactCard />
            </div>
          </div>
        </Splitter.Panel>
      </Splitter>
    </Layout>
  );
}
